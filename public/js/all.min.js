"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var socket=io(),app=angular.module("ships",[]).controller("shipCon",["$scope",function(e){var t=function e(t,o,r,n,i){_classCallCheck(this,e),this.type=t||"structural",this.px=o,this.py=r,this.x="l"==n?o-1:"r"==n?o+1:o,this.y="t"==n?r-1:"b"==n?r+1:r,this.deets=i||{}};e.pos={x:90,y:90},e.specialLeft=5,e.removeLast=function(){if(e.parts.length<2)return!1;"structural"!=e.parts.pop().type&&e.specialLeft++,e.partsLocs.pop()},e.checkPartObst=function(t,o){return e.partsLocs.indexOf(t+":"+o)>-1},e.parts=[],e.partsLocs=["0:0"],e.parts.push(new t("structural",0,0,null)),e.makeNewPart=function(o,r,n){if(n.preventDefault(),console.log("E",n.altKey,n.ctrlKey),e.building)return!1;var i={p:0,r:0},a="structural";if(n.altKey||n.ctrlKey?n.altKey?n.ctrlKey?(a="shield",i.p=30,i.r=0):(a="gun",i.p=30,i.r=0):(a="engine",i.p=30,i.r=0):a="structural","structural"!=a&&e.specialLeft--,e.specialLeft<0)bootbox.alert({title:"Invalid Part",message:"You have no more special parts left!"}),e.specialLeft=0;else{var c=new t(a,o.x,o.y,r,i);if(e.checkPartObst(c.x,c.y))return console.log("part already here!",c),!1;e.parts.push(c),e.partsLocs.push(c.x+":"+c.y),e.building=!0,e.buildTimer=setTimeout(function(){e.building=!1},500)}},e.checkEdge=function(t,o){return!("l"==o&&e.partsLocs.indexOf(t.x-1+":"+t.y)>-1)&&(!("r"==o&&e.partsLocs.indexOf(t.x+1+":"+t.y)>-1)&&(!("t"==o&&e.partsLocs.indexOf(t.x+":"+(t.y-1))>-1)&&!("b"==o&&e.partsLocs.indexOf(t.x+":"+(t.y+1))>-1)))},e.getCgStyle=function(){var t=e.partsLocs.map(function(e){return e.split(":").map(function(e){return parseInt(e)})}),o=0,r=0;return t.forEach(function(e){o+=e[0],r+=e[1]}),{x:o/t.length*20+10,y:r/t.length*20+10}},e.getScales=function(){var e=Math.max(document.querySelector("body > div > div.ship-container").scrollHeight,document.querySelector("body > div > div.ship-container").scrollWidth),t=-.01*e+1.5;return t+","+t},e.shipRot=0,window.onkeydown=function(t){65==t.which?e.shipRot-=3:68==t.which&&(e.shipRot+=3),e.$digest()}}]);app.controller("phone-con",["$scope","contFact",function(e,t){e.phoneName=Math.floor(999999999*Math.random()).toString(32).toUpperCase(),e.user=!1,e.role=!1,e.initZero=!1,e.zero={x:null,y:null,z:null},e.currOri={},socket.emit("newPhone",e.phoneName),socket.on("regPhone",function(t){e.phoneName==t.name&&(e.user=t.u,e.role=t.role,e.$apply())}),e.showInf=function(e){e?1==e?bootbox.alert('The game code corresponds to the particular "instance" of the desktop site your phone is connected with.'):bootbox.alert("If set to collective, your phone controls average blade angle. If set to cyclic, your phone controls, generally speaking, the direction of the craft. Finally, if set to joystick, the phone acts as an airplane joystick (plane mode only)."):bootbox.alert("Enter this automatically-generated phone code for the cyclic, collective, or joystick on the desktop site.")},e.setZero=function(){e.zero=angular.copy(e.currOri)},window.addEventListener("deviceorientation",function(o){e.currOri.x=o.beta,e.currOri.y=o.gamma,e.currOri.z=o.alpha,e.initZero||(e.initZero=!0,e.setZero()),t.handleOri(e.zero,e.currOri,e.user,e.role)}),e.reZero=function(){bootbox.confirm("Are you sure you want to re-zero?",function(t){t&&e.setZero()})}}]);